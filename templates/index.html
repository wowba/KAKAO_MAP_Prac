<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>주소를 마커로 띄우기</title>
    <!--    jQuery-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!--    카카오 지도 api-->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{CLIENT_ID}}&libraries=services"></script>
    <script>
        // 지도에 표시된 마커 객체를 가지고 있을 배열입니다
        var markers = [];

        // 배열에 추가된 마커들을 지도에 표시하거나 삭제하는 함수입니다
        function setMarkers(map) {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
            }
        }
        //"도봉구 맛집", "노원구 맛집",

        function getDataDoBong() {
            $.ajax({
                type: "GET",
                url: "/map/dobong",
                data: {},
                success: function (response) {
                    setMarkers(null);
                    let shopdatas = response["shopdatas"]
                    for (let i = 0; i < shopdatas.length; i++) {

                        let gu = shopdatas[i]["gu"]
                        if (gu === "도봉구"){
                            let address = shopdatas[i]["address"]
                        let name = shopdatas[i]["name"]
                        let link = shopdatas[i]["link"]
                        // 주소로 좌표를 검색합니다
                        geocoder.addressSearch(address, function (result, status) {

                            // 정상적으로 검색이 완료됐으면
                            if (status === kakao.maps.services.Status.OK) {

                                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                                // 결과값으로 받은 위치를 마커로 표시합니다
                                var marker = new kakao.maps.Marker({
                                    map: map,
                                    position: coords,
                                    clickable: true
                                });

                                // 인포윈도우로 장소에 대한 설명을 표시합니다
                                var infowindow = new kakao.maps.InfoWindow({
                                    content: `<div style="width:150px;text-align:center;padding:6px 0;">${name}</div>`
                                });

                                kakao.maps.event.addListener(marker, 'mouseover', function () {
                                    // 마커에 마우스오버 이벤트가 발생하면 인포윈도우를 마커위에 표시합니다
                                    infowindow.open(map, marker);
                                });

                                // 마커에 마우스아웃 이벤트를 등록합니다
                                kakao.maps.event.addListener(marker, 'mouseout', function () {
                                    // 마커에 마우스아웃 이벤트가 발생하면 인포윈도우를 제거합니다
                                    infowindow.close();
                                });

                                // 마커에 클릭이벤트를 등록합니다
                                kakao.maps.event.addListener(marker, 'click', function () {
                                    // 해당 링크로 이동합니다
                                    window.open(`${link}`)
                                    ;
                                });
                                // 생성된 마커를 배열에 추가합니다
                                markers.push(marker);
                            }
                        });
                        }


                    }
                }
            })
    }
    function getDataNoWon(){
            $.ajax({
                type: "GET",
                url: "/map/nowon",
                data: {},
                success: function (response) {
                    setMarkers(null);
                    let shopdatas = response["shopdatas"]
                    for (let i = 0; i < shopdatas.length; i++) {

                        let gu = shopdatas[i]["gu"]
                        if (gu === "노원구"){
                            let address = shopdatas[i]["address"]
                        let name = shopdatas[i]["name"]
                        let link = shopdatas[i]["link"]
                        // 주소로 좌표를 검색합니다
                        geocoder.addressSearch(address, function (result, status) {

                            // 정상적으로 검색이 완료됐으면
                            if (status === kakao.maps.services.Status.OK) {

                                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                                // 결과값으로 받은 위치를 마커로 표시합니다
                                var marker = new kakao.maps.Marker({
                                    map: map,
                                    position: coords,
                                    clickable: true
                                });

                                // 인포윈도우로 장소에 대한 설명을 표시합니다
                                var infowindow = new kakao.maps.InfoWindow({
                                    content: `<div style="width:150px;text-align:center;padding:6px 0;">${name}</div>`
                                });

                                kakao.maps.event.addListener(marker, 'mouseover', function () {
                                    // 마커에 마우스오버 이벤트가 발생하면 인포윈도우를 마커위에 표시합니다
                                    infowindow.open(map, marker);
                                });

                                // 마커에 마우스아웃 이벤트를 등록합니다
                                kakao.maps.event.addListener(marker, 'mouseout', function () {
                                    // 마커에 마우스아웃 이벤트가 발생하면 인포윈도우를 제거합니다
                                    infowindow.close();
                                });

                                // 마커에 클릭이벤트를 등록합니다
                                kakao.maps.event.addListener(marker, 'click', function () {
                                    // 해당 링크로 이동합니다
                                    window.open(`${link}`)
                                    ;
                                });
                                // 생성된 마커를 배열에 추가합니다
                                markers.push(marker);
                            }
                        });
                        }


                    }
                }
            })

    }
</script>
</head>
<body>
    <div id="map" style="width:800px;height:800px;"></div>
    <button type="button" onclick="getDataDoBong()">도봉구</button>
    <button type="button" onclick="getDataNoWon()">노원구</button>
</body>


<script>
    var mapContainer = document.getElementById('map'),
        // 지도를 표시할 div
        mapOption = {
            center: new kakao.maps.LatLng(37.5642135, 127.0016985), // 지도의 중심좌표
            level: 8 // 지도의 확대 레벨
        };

    // 지도를 표시할 div와 지도 옵션으로 지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 주소-좌표 변환 객체를 생성합니다
    var geocoder = new kakao.maps.services.Geocoder();

    // 마커에 마우스오버 이벤트를 등록합니다

</script>
</html>